<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VFS License Manager - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Cairo", sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .actions {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .actions h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-group {
            margin: 15px 0;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
            margin-left: 10px;
            width: auto;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .licenses {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .licenses h2 {
            margin-bottom: 20px;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-active {
            background: #d4edda;
            color: #155724;
        }

        .badge-expired {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-revoked {
            background: #f5c6cb;
            color: #721c24;
        }

        .code {
            font-family: monospace;
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            color: #667eea;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .btn-small {
            padding: 5px 15px;
            font-size: 13px;
            margin: 0 2px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 10px;
        }

        .close {
            float: left;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ” VFS License Manager</h1>
            <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙˆØ§Ù„ØªØ±Ø§Ø®ÙŠØµ</p>
        </header>

        <div class="alert alert-success" id="successAlert"></div>
        <div class="alert alert-error" id="errorAlert"></div>

        <!-- Statistics -->
        <div class="stats" id="stats">
            <div class="stat-card">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</h3>
                <div class="value" id="totalLicenses">-</div>
            </div>
            <div class="stat-card">
                <h3>Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                <div class="value" id="activeLicenses">-</div>
            </div>
            <div class="stat-card">
                <h3>Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©</h3>
                <div class="value" id="expiredLicenses">-</div>
            </div>
            <div class="stat-card">
                <h3>Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø©</h3>
                <div class="value" id="revokedLicenses">-</div>
            </div>
            <div class="stat-card">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</h3>
                <div class="value" id="totalDevices">-</div>
            </div>
        </div>

        <!-- Generate License -->
        <div class="actions">
            <h2>â• Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯</h2>
            <form id="generateForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¯Ø© (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)</label>
                        <input type="number" id="expirationDays" value="30" min="1">
                    </div>
                    <div class="form-group">
                        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</label>
                        <input type="number" id="maxDevices" value="1" min="1" max="10">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                        <input type="text" id="customerName" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
                    </div>
                    <div class="form-group">
                        <label>Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                        <input type="email" id="customerEmail" placeholder="customer@example.com">
                    </div>
                </div>

                <div class="checkbox-group">
                    <h4>Ø§Ù„Ø³ÙØ§Ø±Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©:</h4>
                    <label>
                        <input type="checkbox" name="country" value="The Netherlands" checked> Ù‡ÙˆÙ„Ù†Ø¯Ø§
                    </label>
                    <label>
                        <input type="checkbox" name="country" value="Greece" checked> Ø§Ù„ÙŠÙˆÙ†Ø§Ù†
                    </label>
                    <label>
                        <input type="checkbox" name="country" value="portugal" checked> Ø§Ù„Ø¨Ø±ØªØºØ§Ù„
                    </label>
                </div>

                <div class="form-group">
                    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                    <input type="text" id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©...">
                </div>

                <button type="submit" class="btn btn-primary">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯</button>
            </form>
        </div>

        <!-- Licenses List -->
        <div class="licenses">
            <h2>ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</h2>
            <div class="loading" id="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            <table id="licensesTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        <th>Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</th>
                        <th>Ø§Ù„Ø³ÙØ§Ø±Ø§Øª</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>ØªÙ†ØªÙ‡ÙŠ ÙÙŠ</th>
                        <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                        <th>Ø§Ù„ÙƒÙˆØ¯</th>
                    </tr>
                </thead>
                <tbody id="licensesBody">
                </tbody>
            </table>
        </div>
    </div>

    <!-- Generated Code Modal -->
    <div id="codeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 style="margin-bottom: 20px;">âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!</h2>
            <div style="text-align: center; padding: 20px; background: #f0f0f0; border-radius: 10px; margin: 20px 0;">
                <div style="font-size: 32px; font-weight: bold; color: #667eea; letter-spacing: 3px; font-family: monospace;" id="generatedCode"></div>
            </div>
            <div style="margin-top: 20px;">
                <p><strong>Ø§Ù„Ù…Ø¯Ø©:</strong> <span id="modalDays"></span> ÙŠÙˆÙ…</p>
                <p><strong>Ø§Ù„Ø³ÙØ§Ø±Ø§Øª:</strong> <span id="modalCountries"></span></p>
            </div>
            <button class="btn btn-primary" style="margin-top: 20px; width: 100%;" onclick="copyCode()">Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
        </div>
    </div>

    <!-- Edit License Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2 style="margin-bottom: 20px;">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</h2>
            <form id="editForm">
                <div class="form-group">
                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</label>
                    <input type="number" id="editMaxDevices" min="1" max="50" required>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                    <button type="button" class="btn" style="background: #ccc; flex: 1;" onclick="closeEditModal()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Configuration
        const SERVER_URL = 'http://localhost:3000';
        let ADMIN_KEY = localStorage.getItem('vfs_admin_key') || '';

        // Check if admin key is set
        if (!ADMIN_KEY) {
            ADMIN_KEY = prompt('Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (Admin Secret Key):');
            if (ADMIN_KEY) {
                localStorage.setItem('vfs_admin_key', ADMIN_KEY);
            } else {
                alert('Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨!');
                document.body.innerHTML = '<div style="text-align: center; padding: 50px;"><h2>Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2></div>';
            }
        }

        // Fetch with admin key
        async function adminFetch(url, options = {}) {
            options.headers = {
                ...options.headers,
                'x-admin-key': ADMIN_KEY,
                'Content-Type': 'application/json'
            };
            const res = await fetch(`${SERVER_URL}${url}`, options);
            if (res.status === 401) {
                localStorage.removeItem('vfs_admin_key');
                alert('Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­!');
                location.reload();
            }
            return res;
        }

        // Load Stats
        async function loadStats() {
            try {
                const res = await adminFetch('/api/admin/stats');
                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('totalLicenses').textContent = data.stats.totalLicenses;
                    document.getElementById('activeLicenses').textContent = data.stats.activeLicenses;
                    document.getElementById('expiredLicenses').textContent = data.stats.expiredLicenses;
                    document.getElementById('revokedLicenses').textContent = data.stats.revokedLicenses;
                    document.getElementById('totalDevices').textContent = data.stats.totalDevices;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load Licenses
        async function loadLicenses() {
            try {
                document.getElementById('loading').style.display = 'block';
                const res = await adminFetch('/api/admin/licenses');
                const data = await res.json();
                
                if (data.success) {
                    const tbody = document.getElementById('licensesBody');
                    tbody.innerHTML = '';
                    
                    data.licenses.forEach(license => {
                        const row = document.createElement('tr');
                        
                        // Status
                        let statusBadge = '';
                        const now = new Date();
                        const expiresAt = new Date(license.expiresAt);
                        
                        if (license.revoked) {
                            statusBadge = '<span class="badge badge-revoked">Ù…Ø­Ø¸ÙˆØ±</span>';
                        } else if (now > expiresAt) {
                            statusBadge = '<span class="badge badge-expired">Ù…Ù†ØªÙ‡ÙŠ</span>';
                        } else {
                            statusBadge = '<span class="badge badge-active">Ù†Ø´Ø·</span>';
                        }
                        
                        // Countries
                        const countries = license.allowedCountries.join(', ');
                        
                        // Expiry date
                        const expiryDate = expiresAt.toLocaleDateString('ar-EG');
                        
                        row.innerHTML = `
                            <td>
                                <div style="display: flex; gap: 5px; justify-content: flex-end;">
                                    <button class="btn btn-primary btn-small" onclick="openEditModal('${license._id}', ${license.maxDevices})">ØªØ¹Ø¯ÙŠÙ„</button>
                                    ${license.revoked 
                                        ? `<button class="btn btn-success btn-small" onclick="unrevokeLicense('${license._id}')">ÙÙƒ Ø§Ù„Ø­Ø¸Ø±</button>` 
                                        : `<button class="btn btn-danger btn-small" onclick="revokeLicense('${license._id}')">Ø­Ø¸Ø±</button>`
                                    }
                                    <button class="btn btn-danger btn-small" style="background:#dc3545;" onclick="deleteLicense('${license._id}')"><i class="fas fa-trash"></i> Ø­Ø°Ù</button>
                                </div>
                            </td>
                            <td><strong>${license.devices.length}</strong> / ${license.maxDevices}</td>
                            <td style="font-size: 12px;">${countries}</td>
                            <td>${statusBadge}</td>
                            <td>${expiryDate}</td>
                            <td>${license.customerName || '-'}</td>
                            <td><span class="code">${license.code}</span></td>
                        `;
                        
                        tbody.appendChild(row);
                    });
                    
                    document.getElementById('licensesTable').style.display = 'table';
                }
                
                document.getElementById('loading').style.display = 'none';
            } catch (error) {
                console.error('Error loading licenses:', error);
                document.getElementById('loading').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„';
            }
        }

        // Generate License
        document.getElementById('generateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const days = document.getElementById('expirationDays').value;
            const maxDevices = document.getElementById('maxDevices').value;
            const name = document.getElementById('customerName').value;
            const email = document.getElementById('customerEmail').value;
            const notes = document.getElementById('notes').value;
            
            // Get selected countries
            const countryCheckboxes = document.querySelectorAll('input[name="country"]:checked');
            const countries = Array.from(countryCheckboxes).map(cb => cb.value);
            
            if (countries.length === 0) {
                showError('ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø³ÙØ§Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            try {
                const res = await adminFetch('/api/admin/generate', {
                    method: 'POST',
                    body: JSON.stringify({
                        expirationDays: parseInt(days),
                        maxDevices: parseInt(maxDevices),
                        allowedCountries: countries,
                        customerName: name,
                        customerEmail: email,
                        notes: notes
                    })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showSuccess('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!');
                    
                    // Show modal
 document.getElementById('generatedCode').textContent = data.license.code;
                    document.getElementById('modalDays').textContent = days;
                    document.getElementById('modalCountries').textContent = countries.join(', ');
                    document.getElementById('codeModal').style.display = 'block';
                    
                    // Reset form
                    e.target.reset();
                    
                    // Reload data
                    loadStats();
                    loadLicenses();
                } else {
                    showError(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£');
                }
            } catch (error) {
                showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
                console.error(error);
            }
        });

        // Revoke License
        async function revokeLicense(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ØŸ')) return;
            
            try {
                const res = await adminFetch('/api/admin/revoke', {
                    method: 'POST',
                    body: JSON.stringify({ licenseId: id })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showSuccess('ØªÙ… Ø­Ø¸Ø± Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­');
                    loadStats();
                    loadLicenses();
                } else {
                    showError(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£');
                }
            } catch (error) {
                showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
            }
        }

        // Un-Revoke License
        async function unrevokeLicense(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ÙÙƒ Ø§Ù„Ø­Ø¸Ø± Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ØŸ')) return;
            
            try {
                const res = await adminFetch('/api/admin/unrevoke', {
                    method: 'POST',
                    body: JSON.stringify({ licenseId: id })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showSuccess('ØªÙ… ÙÙƒ Ø§Ù„Ø­Ø¸Ø± Ø¨Ù†Ø¬Ø§Ø­');
                    loadStats();
                    loadLicenses();
                } else {
                    showError(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£');
                }
            } catch (error) {
                showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
            }
        }

        // Delete License
        async function deleteLicense(id) {
            if (!confirm('ğŸ›‘ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!')) return;
            
            try {
                const res = await adminFetch('/api/admin/delete', {
                    method: 'POST',
                    body: JSON.stringify({ licenseId: id })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹');
                    loadStats();
                    loadLicenses();
                } else {
                    showError(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£');
                }
            } catch (error) {
                showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
            }
        }

        // Utility functions
        function showSuccess(msg) {
            const alert = document.getElementById('successAlert');
            alert.textContent = msg;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 5000);
        }

        function showError(msg) {
            const alert = document.getElementById('errorAlert');
            alert.textContent = msg;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 5000);
        }

        function closeModal() {
            document.getElementById('codeModal').style.display = 'none';
        }

        function copyCode() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showSuccess('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!');
            });
        }

        // Edit License Functions
        let currentEditLicenseId = null;

        function openEditModal(licenseId, currentMaxDevices) {
            currentEditLicenseId = licenseId;
            document.getElementById('editMaxDevices').value = currentMaxDevices;
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditLicenseId = null;
        }

        document.getElementById('editForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newMaxDevices = parseInt(document.getElementById('editMaxDevices').value);
            
            if (!currentEditLicenseId) return;
            
            try {
                const res = await adminFetch(`/api/admin/license/${currentEditLicenseId}`, {
                    method: 'PATCH',
                    body: JSON.stringify({ maxDevices: newMaxDevices })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showSuccess('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                    closeEditModal();
                    loadLicenses();
                    loadStats();
                } else {
                    showError(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«');
                }
            } catch (error) {
                showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
                console.error(error);
            }
        });

        // Initial load
        loadStats();
        loadLicenses();
        
        // Refresh every 30 seconds
        setInterval(() => {
            loadStats();
            loadLicenses();
        }, 30000);
    </script>
</body>
</html>
